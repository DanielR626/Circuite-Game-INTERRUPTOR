<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>âš¡ CIRCUITO CON INTERRUPTOR</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg-deep:    #060b14;
  --bg-mid:     #0b1423;
  --bg-surface: #111d30;
  --accent:     #00e5ff;
  --accent2:    #7c3aed;
  --accent3:    #10b981;
  --warn:       #f59e0b;
  --danger:     #ef4444;
  --success:    #22c55e;
  --text:       #e2e8f0;
  --text-dim:   #64748b;
  --border:     rgba(0,229,255,0.18);
  --glow-cyan:  0 0 20px rgba(0,229,255,0.5);
  --glow-green: 0 0 20px rgba(16,185,129,0.6);
  --glow-red:   0 0 20px rgba(239,68,68,0.6);
  --radius:     16px;
  --radius-lg:  24px;
}

html { scroll-behavior: smooth; }

body {
  font-family: 'Rajdhani', sans-serif;
  background: var(--bg-deep);
  color: var(--text);
  min-height: 100vh;
  padding: 16px;
  overflow-x: hidden;
  -webkit-font-smoothing: antialiased;
}

/* PCB grid background â€” CSS only, no JS, no perf cost */
body::before {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    linear-gradient(rgba(0,229,255,0.04) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0,229,255,0.04) 1px, transparent 1px);
  background-size: 40px 40px;
}

/* Subtle radial glow at top */
body::after {
  content: '';
  position: fixed; inset: 0; z-index: 0; pointer-events: none;
  background: radial-gradient(ellipse 80% 40% at 50% 0%, rgba(124,58,237,0.15) 0%, transparent 70%);
}

.container {
  max-width: 1300px;
  margin: 0 auto;
  position: relative; z-index: 1;
  display: flex; flex-direction: column; gap: 20px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  HEADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.header {
  background: linear-gradient(135deg, rgba(124,58,237,0.2), rgba(0,229,255,0.1));
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 28px 32px;
  display: flex; flex-direction: column; gap: 14px;
  position: relative; overflow: hidden;
}

.header::before {
  content: '';
  position: absolute; top: 0; left: 0; right: 0; height: 2px;
  background: linear-gradient(90deg, transparent, var(--accent), var(--accent2), var(--accent), transparent);
  animation: scanline 3s linear infinite;
}

@keyframes scanline {
  0%   { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.header-top {
  display: flex; align-items: center; justify-content: space-between; gap: 16px;
  flex-wrap: wrap;
}

.game-title {
  font-family: 'Orbitron', monospace;
  font-size: clamp(1.2rem, 3.5vw, 2.2rem);
  font-weight: 900;
  color: var(--accent);
  text-shadow: 0 0 30px rgba(0,229,255,0.6), 0 0 60px rgba(0,229,255,0.3);
  letter-spacing: 3px;
  line-height: 1.2;
}

.game-title span { color: #fff; }

.status-badges {
  display: flex; gap: 10px; flex-wrap: wrap;
}

.badge {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 14px; border-radius: 50px;
  border: 1px solid; font-size: 0.8rem; font-weight: 700;
  letter-spacing: 1px; text-transform: uppercase;
  font-family: 'Orbitron', monospace;
}

.badge-wires { border-color: var(--warn); color: var(--warn); background: rgba(245,158,11,0.1); }
.badge-switch { border-color: var(--danger); color: var(--danger); background: rgba(239,68,68,0.1); }
.badge-switch.on { border-color: var(--success); color: var(--success); background: rgba(34,197,94,0.1); }
.badge-led { border-color: var(--text-dim); color: var(--text-dim); background: rgba(100,116,139,0.1); }
.badge-led.on { border-color: var(--danger); color: var(--danger); background: rgba(239,68,68,0.15); box-shadow: 0 0 12px rgba(239,68,68,0.4); }

.badge .dot {
  width: 7px; height: 7px; border-radius: 50%;
  background: currentColor;
}

.badge-switch.on .dot { animation: blink 0.8s ease-in-out infinite; }
.badge-led.on .dot { animation: blink 0.6s ease-in-out infinite; }

@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* Progress bar */
.progress-wrap { position: relative; }
.progress-label {
  display: flex; justify-content: space-between;
  font-size: 0.75rem; color: var(--text-dim); margin-bottom: 6px;
  font-family: 'Orbitron', monospace;
}
.progress-track {
  height: 6px; background: rgba(255,255,255,0.06);
  border-radius: 99px; overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
}
.progress-fill {
  height: 100%; width: 0%;
  background: linear-gradient(90deg, var(--accent2), var(--accent));
  border-radius: 99px;
  transition: width 0.6s cubic-bezier(0.34,1.56,0.64,1);
  box-shadow: 0 0 12px rgba(0,229,255,0.5);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMPONENT GUIDE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.guide {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 28px;
}

.section-title {
  font-family: 'Orbitron', monospace;
  font-size: clamp(0.85rem, 2vw, 1.1rem);
  font-weight: 700; color: var(--accent);
  letter-spacing: 2px; text-transform: uppercase;
  margin-bottom: 20px; padding-bottom: 12px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; gap: 10px;
}

.section-title::before {
  content: '';
  width: 4px; height: 18px; background: var(--accent);
  border-radius: 2px; box-shadow: var(--glow-cyan);
}

.guide-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
  gap: 14px;
}

.comp-card {
  background: var(--bg-mid);
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: var(--radius);
  padding: 20px 16px;
  cursor: pointer;
  transition: transform 0.25s ease, border-color 0.25s ease, box-shadow 0.25s ease;
  text-align: center;
  position: relative; overflow: hidden;
}

.comp-card::after {
  content: '';
  position: absolute; inset: 0;
  background: radial-gradient(circle at 50% 0%, rgba(0,229,255,0.08) 0%, transparent 70%);
  opacity: 0; transition: opacity 0.3s;
}

.comp-card:hover {
  transform: translateY(-5px);
  border-color: var(--accent);
  box-shadow: var(--glow-cyan), 0 20px 40px rgba(0,0,0,0.4);
}
.comp-card:hover::after { opacity: 1; }

.comp-card-icon { font-size: 2.4rem; margin-bottom: 10px; display: block; }
.comp-card-name {
  font-family: 'Orbitron', monospace;
  font-size: 0.8rem; font-weight: 700;
  color: #fff; margin-bottom: 6px; letter-spacing: 1px;
}
.comp-card-desc { font-size: 0.82rem; color: var(--text-dim); line-height: 1.5; margin-bottom: 12px; }
.comp-card-tag {
  display: inline-block;
  padding: 3px 12px; border-radius: 99px;
  font-size: 0.72rem; font-weight: 700;
  font-family: 'Orbitron', monospace; letter-spacing: 1px;
}

.tag-green  { background: rgba(16,185,129,0.15); color: var(--accent3); border: 1px solid rgba(16,185,129,0.4); }
.tag-cyan   { background: rgba(0,229,255,0.12); color: var(--accent); border: 1px solid rgba(0,229,255,0.3); }
.tag-orange { background: rgba(245,158,11,0.15); color: var(--warn); border: 1px solid rgba(245,158,11,0.3); }
.tag-red    { background: rgba(239,68,68,0.15); color: var(--danger); border: 1px solid rgba(239,68,68,0.3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MAIN GRID
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main-grid {
  display: grid;
  grid-template-columns: 320px 1fr;
  gap: 20px;
  align-items: start;
}

@media (max-width: 1000px) {
  .main-grid { grid-template-columns: 1fr; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MISSION PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mission-panel {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  display: flex; flex-direction: column; gap: 12px;
}

.mission-item {
  display: flex; align-items: flex-start; gap: 12px;
  padding: 14px;
  background: var(--bg-mid);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: var(--radius);
  transition: all 0.3s ease;
}

.mission-item.done {
  border-color: rgba(34,197,94,0.35);
  background: rgba(34,197,94,0.06);
}

.mission-num {
  min-width: 28px; height: 28px;
  background: rgba(124,58,237,0.3);
  border: 1px solid rgba(124,58,237,0.5);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', monospace; font-size: 0.65rem; font-weight: 700;
  color: #a78bfa; flex-shrink: 0;
  transition: all 0.3s;
}

.mission-item.done .mission-num {
  background: rgba(34,197,94,0.25);
  border-color: rgba(34,197,94,0.6);
  color: var(--success);
}

.mission-item.done .mission-num::after { content: 'âœ“'; }
.mission-item:not(.done) .mission-num::after { content: attr(data-n); }

.mission-text {
  font-size: 0.88rem; line-height: 1.55;
  color: rgba(226,232,240,0.75);
}

.mission-item.done .mission-text { color: rgba(226,232,240,0.45); text-decoration: line-through; }
.mission-text strong { color: #fff; font-weight: 700; }

/* Instructions box */
.instr-box {
  background: rgba(245,158,11,0.07);
  border: 1px solid rgba(245,158,11,0.25);
  border-radius: var(--radius);
  padding: 14px;
  font-size: 0.84rem; line-height: 1.6; color: rgba(226,232,240,0.8);
}

.instr-box strong { color: var(--warn); }

/* Buttons */
.btn {
  display: block; width: 100%; padding: 13px 20px;
  border: none; border-radius: var(--radius); cursor: pointer;
  font-family: 'Orbitron', monospace; font-size: 0.8rem; font-weight: 700;
  letter-spacing: 1.5px; text-transform: uppercase;
  transition: all 0.2s ease;
  position: relative; overflow: hidden;
}

.btn::after {
  content: '';
  position: absolute; inset: 0;
  background: rgba(255,255,255,0.12);
  opacity: 0; transition: opacity 0.2s;
}

.btn:hover::after { opacity: 1; }
.btn:active { transform: scale(0.97); }

.btn-verify {
  background: linear-gradient(135deg, #059669, #10b981);
  color: #fff;
  box-shadow: 0 4px 20px rgba(16,185,129,0.3);
}

.btn-verify:hover { box-shadow: 0 6px 28px rgba(16,185,129,0.5); transform: translateY(-2px); }

.btn-reset {
  background: transparent;
  color: var(--text-dim); border: 1px solid rgba(255,255,255,0.12);
}

.btn-reset:hover { border-color: var(--danger); color: var(--danger); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BOARD PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.board-panel {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  display: flex; flex-direction: column; gap: 14px;
}

.touch-hint {
  display: none;
  background: rgba(0,229,255,0.07);
  border: 1px solid rgba(0,229,255,0.2);
  border-radius: 10px; padding: 8px 14px;
  font-size: 0.8rem; color: var(--accent); text-align: center;
}

@media (max-width: 900px) { .touch-hint { display: block; } }

/* PCB Container */
.pcb-wrapper {
  overflow-x: auto; overflow-y: hidden;
  border-radius: var(--radius);
  -webkit-overflow-scrolling: touch;
}

.pcb-wrapper::-webkit-scrollbar { height: 4px; }
.pcb-wrapper::-webkit-scrollbar-thumb { background: rgba(0,229,255,0.3); border-radius: 99px; }

#board {
  position: relative;
  width: 100%; min-height: 480px;
  border-radius: var(--radius);
  overflow: visible;
  user-select: none;
  touch-action: none;

  /* PCB green board look */
  background:
    radial-gradient(ellipse at 30% 40%, rgba(0,60,30,0.6) 0%, transparent 55%),
    radial-gradient(ellipse at 70% 60%, rgba(0,30,60,0.5) 0%, transparent 55%),
    linear-gradient(180deg, #071e12 0%, #051510 50%, #041208 100%);

  border: 1px solid rgba(0,180,80,0.3);
  box-shadow:
    inset 0 0 80px rgba(0,0,0,0.6),
    0 0 0 1px rgba(0,255,100,0.08),
    0 8px 40px rgba(0,0,0,0.6);
}

/* PCB trace pattern */
#board::before {
  content: '';
  position: absolute; inset: 0; z-index: 0; pointer-events: none;
  background-image:
    repeating-linear-gradient(0deg, rgba(0,160,60,0.06) 0, rgba(0,160,60,0.06) 1px, transparent 1px, transparent 24px),
    repeating-linear-gradient(90deg, rgba(0,160,60,0.06) 0, rgba(0,160,60,0.06) 1px, transparent 1px, transparent 24px);
}

/* Corner markers */
.corner {
  position: absolute; width: 18px; height: 18px;
  z-index: 20; pointer-events: none;
}
.corner::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: rgba(0,255,100,0.6); }
.corner::after  { content: ''; position: absolute; top: 0; left: 0; width: 2px; height: 100%; background: rgba(0,255,100,0.6); }
.corner.tl { top: 10px; left: 10px; }
.corner.tr { top: 10px; right: 10px; transform: scaleX(-1); }
.corner.bl { bottom: 10px; left: 10px; transform: scaleY(-1); }
.corner.br { bottom: 10px; right: 10px; transform: scale(-1); }

/* HUD label */
.board-hud {
  position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
  z-index: 20; display: flex; align-items: center; gap: 8px;
  background: rgba(0,0,0,0.65); border: 1px solid rgba(0,255,100,0.3);
  border-radius: 99px; padding: 5px 16px;
}

.hud-dot {
  width: 6px; height: 6px; border-radius: 50%;
  background: #39ff14; box-shadow: 0 0 8px #39ff14;
  animation: blink 1.5s ease-in-out infinite;
}

.hud-text {
  font-family: 'Orbitron', monospace;
  font-size: 0.6rem; color: rgba(57,255,20,0.9);
  letter-spacing: 2px;
}

/* SVG Wires */
#wire-svg {
  position: absolute; inset: 0;
  width: 100%; height: 100%;
  pointer-events: none; z-index: 5;
  overflow: visible;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.comp {
  position: absolute; z-index: 10;
  cursor: grab; touch-action: none; user-select: none;
  transition: filter 0.2s, transform 0.2s;
  will-change: transform;
}

.comp:hover { z-index: 15; }
.comp.dragging {
  cursor: grabbing; z-index: 100; opacity: 0.92;
  filter: drop-shadow(0 0 20px rgba(0,229,255,0.7));
  transform: scale(1.05) !important;
}

.comp-shell {
  background: linear-gradient(145deg, rgba(0,40,20,0.98), rgba(0,20,10,0.99));
  border: 1px solid rgba(0,200,80,0.35);
  border-radius: 12px; padding: 8px;
  box-shadow:
    0 0 0 1px rgba(0,200,80,0.12),
    0 8px 24px rgba(0,0,0,0.7),
    inset 0 1px 0 rgba(255,255,255,0.06);
}

/* â”€â”€ BATTERY â”€â”€ */
.battery-comp { width: 90px; }

.battery-body {
  width: 66px; height: 120px; margin: 0 auto;
  background: linear-gradient(180deg, #34d399 0%, #10b981 40%, #059669 80%, #065f46 100%);
  border: 2px solid rgba(16,185,129,0.7);
  border-radius: 10px; position: relative;
  box-shadow: 0 0 0 1px rgba(16,185,129,0.3), 0 0 20px rgba(16,185,129,0.3), inset 0 2px 8px rgba(255,255,255,0.25);
  animation: batteryPulse 3s ease-in-out infinite;
}

@keyframes batteryPulse {
  0%,100% { box-shadow: 0 0 0 1px rgba(16,185,129,0.3), 0 0 20px rgba(16,185,129,0.3), inset 0 2px 8px rgba(255,255,255,0.25); }
  50%      { box-shadow: 0 0 0 1px rgba(16,185,129,0.5), 0 0 35px rgba(16,185,129,0.5), inset 0 2px 8px rgba(255,255,255,0.25); }
}

/* battery cap */
.battery-body::before {
  content: '';
  position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
  width: 22px; height: 10px;
  background: linear-gradient(180deg, #6b7280, #4b5563);
  border-radius: 4px 4px 0 0;
  border: 1px solid rgba(255,255,255,0.2);
}

.battery-volt {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%);
  font-family: 'Orbitron', monospace; font-size: 1rem; font-weight: 900;
  color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.8);
}

.battery-pole {
  position: absolute; left: 50%; transform: translateX(-50%);
  width: 4px; border-radius: 3px;
}

.pole-pos { top: -20px; height: 22px; background: linear-gradient(180deg, #ef4444, #dc2626); box-shadow: 0 0 8px rgba(239,68,68,0.6); }
.pole-neg { bottom: -20px; height: 22px; background: linear-gradient(180deg, #94a3b8, #64748b); }

.battery-sign {
  position: absolute; width: 18px; height: 18px;
  border-radius: 50%; border: 1px solid; z-index: 5;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', monospace; font-size: 0.65rem; font-weight: 900;
}

.sign-pos { top: 4px; right: 3px; color: #ef4444; border-color: #ef4444; background: rgba(239,68,68,0.15); }
.sign-neg { bottom: 4px; right: 3px; color: #94a3b8; border-color: #64748b; background: rgba(100,116,139,0.15); }

/* â”€â”€ SWITCH â”€â”€ */
.switch-comp { width: 130px; }

.switch-body {
  width: 110px; height: 68px; margin: 0 auto;
  background: linear-gradient(135deg, rgba(0,20,50,0.98), rgba(0,10,30,0.99));
  border: 1px solid rgba(79,172,254,0.4);
  border-radius: 12px; position: relative;
  display: flex; align-items: center; justify-content: center;
  box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
}

.switch-btn {
  width: 52px; height: 52px;
  background: linear-gradient(135deg, #dc2626, #b91c1c);
  border: 2px solid rgba(255,255,255,0.3);
  border-radius: 50%; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-family: 'Orbitron', monospace; font-size: 0.5rem; font-weight: 900;
  color: #fff; touch-action: manipulation;
  box-shadow: 0 0 15px rgba(220,38,38,0.5), 0 4px 12px rgba(0,0,0,0.6);
  transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
  position: relative; z-index: 15;
  letter-spacing: 1px;
}

.switch-btn:hover { transform: scale(1.08); }
.switch-btn:active { transform: scale(0.95); }

.switch-comp.sw-on .switch-btn {
  background: linear-gradient(135deg, #16a34a, #15803d);
  box-shadow: 0 0 25px rgba(22,163,74,0.8), 0 0 50px rgba(22,163,74,0.4), 0 4px 12px rgba(0,0,0,0.6);
  animation: switchGlow 0.8s ease-in-out infinite;
}

@keyframes switchGlow {
  0%,100% { box-shadow: 0 0 25px rgba(22,163,74,0.7), 0 4px 12px rgba(0,0,0,0.6); }
  50%      { box-shadow: 0 0 40px rgba(22,163,74,1), 0 0 70px rgba(22,163,74,0.5), 0 4px 12px rgba(0,0,0,0.6); }
}

.switch-state-label {
  position: absolute; bottom: -22px; left: 50%; transform: translateX(-50%);
  font-family: 'Orbitron', monospace; font-size: 0.5rem; font-weight: 700;
  color: #ef4444; letter-spacing: 1.5px; white-space: nowrap;
  transition: color 0.3s;
}

.switch-comp.sw-on .switch-state-label { color: #22c55e; }

/* LED indicators on switch body */
.switch-led-strip {
  position: absolute; bottom: 6px; right: 6px;
  display: flex; gap: 3px;
}

.s-led {
  width: 6px; height: 6px; border-radius: 50%;
  background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.15);
  transition: all 0.3s;
}

.switch-comp.sw-on .s-led:nth-child(1) { background: #22c55e; box-shadow: 0 0 6px #22c55e; }
.switch-comp.sw-on .s-led:nth-child(2) { background: #22c55e; box-shadow: 0 0 6px #22c55e; animation-delay: 0.1s; }
.switch-comp.sw-on .s-led:nth-child(3) { background: #22c55e; box-shadow: 0 0 6px #22c55e; animation-delay: 0.2s; }

/* â”€â”€ RESISTOR â”€â”€ */
.resistor-comp { width: 150px; }

.resistor-body {
  width: 130px; height: 38px; margin: 0 auto;
  position: relative;
  background: linear-gradient(90deg,
    #b97a3a 0%, #d4a05a 8%, #b97a3a 18%,
    #4a1c00 24%, #b97a3a 30%,
    #d4c020 36%, #b97a3a 42%,
    #d06010 48%, #b97a3a 56%,
    #d4a05a 62%, #b97a3a 68%,
    #4a1c00 72%, #b97a3a 78%,
    #d4a05a 88%, #b97a3a 100%
  );
  border-radius: 8px;
  border: 1px solid rgba(185,122,58,0.6);
  box-shadow: 0 0 12px rgba(212,160,90,0.3), 0 4px 10px rgba(0,0,0,0.5);
}

.res-label {
  position: absolute; top: -24px; left: 50%; transform: translateX(-50%);
  font-family: 'Orbitron', monospace; font-size: 0.55rem; font-weight: 700;
  color: var(--warn); letter-spacing: 1px; white-space: nowrap;
}

.res-lead {
  position: absolute; top: 50%; transform: translateY(-50%);
  height: 2px; background: #94a3b8;
}
.res-lead-l { left: -18px; width: 18px; }
.res-lead-r { right: -18px; width: 18px; }

/* â”€â”€ LED â”€â”€ */
.led-comp { width: 84px; }

.led-dome {
  width: 64px; height: 64px; margin: 0 auto;
  border-radius: 50% 50% 46% 46%;
  background: radial-gradient(circle at 35% 30%,
    #ffc0c0 0%, #ff8080 25%, #ff4444 50%, #cc1111 75%, #880000 100%
  );
  border: 2px solid rgba(255,100,100,0.4);
  position: relative;
  box-shadow: 0 0 20px rgba(255,50,50,0.3), 0 5px 15px rgba(0,0,0,0.6), inset 0 3px 10px rgba(255,255,255,0.3);
  transition: all 0.3s;
}

.led-dome::before {
  content: '';
  position: absolute; top: 8px; left: 10px;
  width: 24px; height: 24px;
  background: radial-gradient(circle, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.2) 70%, transparent 100%);
  border-radius: 50%;
}

.led-dome::after {
  content: '';
  position: absolute; top: 12px; left: 14px;
  width: 12px; height: 12px;
  background: rgba(255,255,255,1); border-radius: 50%;
}

.led-comp.led-on .led-dome {
  background: radial-gradient(circle at 35% 30%,
    #ffaaaa 0%, #ff3333 25%, #ff0000 50%, #cc0000 75%, #880000 100%
  );
  box-shadow:
    0 0 40px #ff0000,
    0 0 80px rgba(255,0,0,0.6),
    0 0 120px rgba(255,0,0,0.3),
    0 5px 15px rgba(0,0,0,0.6);
  animation: ledBright 0.6s ease-in-out infinite;
}

@keyframes ledBright {
  0%,100% { filter: brightness(1.3) saturate(1.2); }
  50%      { filter: brightness(1.9) saturate(1.6); }
}

.led-pin {
  position: absolute; width: 3px; border-radius: 2px;
  background: linear-gradient(180deg, #b2bec3, #636e72);
  border: 1px solid rgba(99,110,114,0.6);
}

.pin-long { top: 0; left: 16px; height: 20px; }
.pin-short { bottom: 0; right: 16px; height: 14px; }

.led-sign {
  position: absolute; font-size: 0.7rem; font-weight: 900;
  width: 16px; height: 16px; border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  border: 1px solid; z-index: 5; background: rgba(0,0,0,0.8);
  font-family: 'Orbitron', monospace;
}

.lsign-pos { top: -5px; left: 12px; color: #ef4444; border-color: #ef4444; }
.lsign-neg { bottom: -5px; right: 12px; color: #94a3b8; border-color: #64748b; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CONNECTION POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cp {
  position: absolute;
  width: 34px; height: 34px;
  border-radius: 50%;
  cursor: pointer; z-index: 15;
  touch-action: manipulation;
  background: radial-gradient(circle, rgba(245,158,11,0.9), rgba(217,119,6,0.7));
  border: 2px solid rgba(245,158,11,0.8);
  box-shadow: 0 0 10px rgba(245,158,11,0.4), 0 3px 8px rgba(0,0,0,0.5);
  transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1);
  display: flex; align-items: center; justify-content: center;
}

.cp::before {
  content: '';
  width: 10px; height: 10px; border-radius: 50%;
  background: rgba(255,240,180,0.9);
}

/* tooltip */
.cp[data-tip]::after {
  content: attr(data-tip);
  position: absolute; bottom: 130%; left: 50%; transform: translateX(-50%);
  background: rgba(0,0,0,0.9); color: var(--warn);
  padding: 5px 10px; border-radius: 8px; font-size: 0.72rem; white-space: nowrap;
  opacity: 0; pointer-events: none; transition: opacity 0.2s;
  border: 1px solid rgba(245,158,11,0.4); font-weight: 700;
  font-family: 'Rajdhani', sans-serif;
}

.cp:hover[data-tip]::after { opacity: 1; }

.cp:hover {
  transform: scale(1.5);
  background: radial-gradient(circle, #fde68a, #f59e0b);
  box-shadow: 0 0 25px rgba(245,158,11,0.9), 0 0 50px rgba(245,158,11,0.4);
  border-color: #fde68a;
}

.cp.cp-selected {
  background: radial-gradient(circle, #67e8f9, #06b6d4);
  border-color: var(--accent);
  animation: cpPulse 0.5s ease-in-out infinite;
  box-shadow: 0 0 25px rgba(0,229,255,0.9);
}

@keyframes cpPulse {
  0%,100% { transform: scale(1); }
  50%      { transform: scale(1.35); }
}

.cp.cp-connected {
  background: radial-gradient(circle, #86efac, #22c55e);
  border-color: var(--success);
  box-shadow: 0 0 15px rgba(34,197,94,0.7);
  animation: cpConnected 1.5s ease-in-out infinite;
}

@keyframes cpConnected {
  0%,100% { box-shadow: 0 0 15px rgba(34,197,94,0.6); }
  50%      { box-shadow: 0 0 28px rgba(34,197,94,1), 0 0 50px rgba(34,197,94,0.4); }
}

/* â”€â”€ Default positions â”€â”€ */
/* will be overridden by JS on init */
#comp-battery  { left: 60px;  top: 50%; transform: translateY(-50%); }
#comp-switch   { left: 220px; top: 50%; transform: translateY(-50%); }
#comp-resistor { left: 400px; top: 50%; transform: translateY(-50%); }
#comp-led      { left: 580px; top: 50%; transform: translateY(-50%); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  INFO BOX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-section {
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px 28px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

@media (max-width: 700px) { .info-section { grid-template-columns: 1fr; } }

.info-block { display: flex; flex-direction: column; gap: 8px; }
.info-block-title {
  font-family: 'Orbitron', monospace; font-size: 0.78rem; font-weight: 700;
  color: var(--accent); letter-spacing: 1.5px; text-transform: uppercase;
  display: flex; align-items: center; gap: 8px;
}

.info-block-title::before { content: ''; width: 3px; height: 14px; background: var(--accent); border-radius: 2px; }

.info-block p {
  font-size: 0.9rem; line-height: 1.65;
  color: rgba(226,232,240,0.75);
}

.info-block p strong { color: #fff; font-weight: 700; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast {
  position: fixed; top: 20px; right: 20px;
  padding: 14px 22px; border-radius: var(--radius);
  font-weight: 700; font-size: 0.9rem;
  z-index: 9000; max-width: min(90vw, 420px);
  transform: translateX(calc(100% + 40px));
  transition: transform 0.4s cubic-bezier(0.34,1.56,0.64,1);
  border: 1px solid; backdrop-filter: blur(12px);
  font-family: 'Rajdhani', sans-serif;
  box-shadow: 0 8px 32px rgba(0,0,0,0.5);
}

.toast.show { transform: translateX(0); }

.toast-success { background: rgba(34,197,94,0.15); color: #22c55e; border-color: rgba(34,197,94,0.35); }
.toast-error   { background: rgba(239,68,68,0.15); color: #f87171; border-color: rgba(239,68,68,0.35); }
.toast-info    { background: rgba(0,229,255,0.12); color: var(--accent); border-color: rgba(0,229,255,0.3); }
.toast-warning { background: rgba(245,158,11,0.12); color: var(--warn); border-color: rgba(245,158,11,0.3); }

@media (max-width: 600px) {
  .toast { top: 12px; right: 12px; left: 12px; max-width: none; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CELEBRATION MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay {
  position: fixed; inset: 0; z-index: 9999;
  background: rgba(0,0,0,0.85);
  display: none; align-items: center; justify-content: center;
  padding: 20px; backdrop-filter: blur(10px);
}

.overlay.active { display: flex; animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }

.modal-card {
  background: linear-gradient(145deg, var(--bg-surface), var(--bg-mid));
  border: 1px solid rgba(124,58,237,0.5);
  border-radius: var(--radius-lg);
  padding: clamp(28px,5vw,52px);
  text-align: center; max-width: 520px; width: 100%;
  position: relative;
  box-shadow: 0 0 60px rgba(124,58,237,0.3), 0 30px 60px rgba(0,0,0,0.6);
  animation: cardPop 0.5s cubic-bezier(0.34,1.56,0.64,1);
}

@keyframes cardPop { from{transform:scale(0.4);opacity:0} to{transform:scale(1);opacity:1} }

.modal-close {
  position: absolute; top: 14px; right: 14px;
  background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.15);
  width: 36px; height: 36px; border-radius: 50%;
  color: rgba(255,255,255,0.7); font-size: 1.1rem; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
}

.modal-close:hover { background: rgba(239,68,68,0.2); border-color: var(--danger); color: var(--danger); }

.modal-emoji { font-size: clamp(2.5rem,6vw,4rem); display: block; margin-bottom: 12px; animation: bounce 1s ease-in-out infinite; }
@keyframes bounce { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-14px)} }

.modal-title {
  font-family: 'Orbitron', monospace;
  font-size: clamp(1.3rem,4vw,2rem); font-weight: 900;
  color: #fff; margin-bottom: 14px;
  text-shadow: 0 0 30px rgba(0,229,255,0.6);
}

.modal-text { font-size: 1rem; line-height: 1.7; color: rgba(226,232,240,0.8); margin-bottom: 24px; }
.modal-text strong { color: #fff; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  INFO MODAL (component details)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.info-modal {
  position: fixed; inset: 0; z-index: 10000;
  background: rgba(0,0,0,0.9);
  display: none; align-items: flex-start; justify-content: center;
  padding: 20px; overflow-y: auto; backdrop-filter: blur(12px);
}

.info-modal.active { display: flex; animation: fadeIn 0.3s ease; }

.info-modal-card {
  background: linear-gradient(145deg, #0f1e35, #0b1520);
  border: 1px solid rgba(0,229,255,0.35);
  border-radius: var(--radius-lg); padding: clamp(20px,4vw,44px);
  max-width: 780px; width: 100%; margin: auto; position: relative;
  box-shadow: 0 0 50px rgba(0,229,255,0.2), 0 30px 60px rgba(0,0,0,0.7);
  animation: cardPop 0.4s cubic-bezier(0.34,1.56,0.64,1);
}

.info-modal-title {
  font-family: 'Orbitron', monospace;
  font-size: clamp(1rem,2.5vw,1.5rem); font-weight: 700;
  color: var(--accent); margin-bottom: 20px; padding-bottom: 14px;
  border-bottom: 1px solid var(--border);
  padding-right: 48px;
}

.info-section-block {
  background: rgba(255,255,255,0.03);
  border: 1px solid rgba(255,255,255,0.07);
  border-left: 3px solid var(--accent);
  border-radius: 12px; padding: 16px; margin: 14px 0;
  transition: border-left-color 0.25s;
}

.info-section-block:hover { border-left-color: var(--accent2); }
.info-section-block h3 { color: var(--accent); font-weight: 700; margin-bottom: 8px; font-size: 0.95rem; }
.info-section-block p { color: rgba(226,232,240,0.8); line-height: 1.7; font-size: 0.9rem; margin-bottom: 6px; }
.info-section-block p strong { color: #fff; }
.info-section-block ul { margin: 8px 0 0 18px; color: rgba(226,232,240,0.75); }
.info-section-block li { margin: 6px 0; line-height: 1.6; font-size: 0.88rem; }
.info-section-block li strong { color: #fff; }

/* SVG circuit symbol */
.circuit-svg {
  width: 100%; max-width: 320px; display: block; margin: 14px auto;
  background: rgba(0,0,0,0.4); padding: 14px; border-radius: 12px;
  border: 1px solid rgba(0,229,255,0.2);
}

/* color table */
.color-table {
  width: 100%; border-collapse: collapse;
  margin: 12px 0; font-size: 0.84rem; border-radius: 10px; overflow: hidden;
}

.color-table th {
  background: rgba(124,58,237,0.4); color: #fff;
  padding: 9px 12px; font-weight: 700; text-align: left;
}

.color-table td {
  padding: 8px 12px; border-bottom: 1px solid rgba(255,255,255,0.05);
  font-weight: 600; color: rgba(226,232,240,0.85);
  background: rgba(255,255,255,0.02);
}

.color-table tr:last-child td { border-bottom: none; }
.color-table tr:hover td { background: rgba(124,58,237,0.1); }

.color-swatch {
  display: inline-block; width: 24px; height: 16px;
  border-radius: 4px; margin-right: 8px; vertical-align: middle;
  border: 1px solid rgba(255,255,255,0.3);
}

/* Confetti */
.confetti-p {
  position: fixed; width: 9px; height: 9px;
  animation: confFall 4s linear forwards;
  border-radius: 2px; z-index: 10000; pointer-events: none;
}

@keyframes confFall {
  0%   { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
  100% { transform: translateY(110vh) rotate(720deg); opacity: 0; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESPONSIVE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
  body { padding: 12px; }
  .header { padding: 20px 18px; }
  .guide, .mission-panel, .board-panel, .info-section { padding: 18px 16px; }
  #board { min-height: 520px; }
}

@media (max-width: 480px) {
  body { padding: 8px; }
  .guide-grid { grid-template-columns: repeat(2, 1fr); }
  #board { min-height: 600px; }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after { animation-duration: 0.01ms !important; transition-duration: 0.01ms !important; }
}

/* â”€â”€ Electric flow on active wires â”€â”€ */
.wire-active {
  stroke-dasharray: 12 8;
  animation: wireFlow 0.8s linear infinite;
}

@keyframes wireFlow {
  to { stroke-dashoffset: -20; }
}
</style>
</head>
<body>

<div class="container">

  <!-- â•â•â• HEADER â•â•â• -->
  <header class="header">
    <div class="header-top">
      <h1 class="game-title">âš¡ <span>CIRCUITO</span> CON INTERRUPTOR</h1>
      <div class="status-badges">
        <div class="badge badge-wires" id="badge-wires">
          <span class="dot"></span>
          <span id="badge-wires-txt">0 / 4 cables</span>
        </div>
        <div class="badge badge-switch" id="badge-switch">
          <span class="dot"></span>
          <span>Interruptor OFF</span>
        </div>
        <div class="badge badge-led" id="badge-led">
          <span class="dot"></span>
          <span>LED OFF</span>
        </div>
      </div>
    </div>
    <div class="progress-wrap">
      <div class="progress-label">
        <span>Progreso del circuito</span>
        <span id="prog-pct">0%</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="prog-fill"></div>
      </div>
    </div>
  </header>

  <!-- â•â•â• COMPONENT GUIDE â•â•â• -->
  <section class="guide">
    <h2 class="section-title">GuÃ­a de Componentes</h2>
    <div class="guide-grid">
      <div class="comp-card" onclick="openModal('battery')">
        <span class="comp-card-icon">ğŸ”‹</span>
        <div class="comp-card-name">BaterÃ­a</div>
        <p class="comp-card-desc">Fuente de energÃ­a que alimenta el circuito</p>
        <span class="comp-card-tag tag-green">9V</span>
      </div>
      <div class="comp-card" onclick="openModal('switch')">
        <span class="comp-card-icon">âš¡</span>
        <div class="comp-card-name">Interruptor</div>
        <p class="comp-card-desc">Controla el flujo de corriente elÃ©ctrica</p>
        <span class="comp-card-tag tag-cyan">ON / OFF</span>
      </div>
      <div class="comp-card" onclick="openModal('resistor')">
        <span class="comp-card-icon" style="font-size:1.6rem;margin:6px 0">â”â”â”¯â”â”</span>
        <div class="comp-card-name">Resistencia</div>
        <p class="comp-card-desc">Protege el LED limitando la corriente</p>
        <span class="comp-card-tag tag-orange">330 Î©</span>
      </div>
      <div class="comp-card" onclick="openModal('led')">
        <span class="comp-card-icon">ğŸ’¡</span>
        <div class="comp-card-name">LED</div>
        <p class="comp-card-desc">Emite luz al recibir corriente elÃ©ctrica</p>
        <span class="comp-card-tag tag-red">Rojo</span>
      </div>
    </div>
  </section>

  <!-- â•â•â• MAIN GRID â•â•â• -->
  <div class="main-grid">

    <!-- Mission Panel -->
    <aside class="mission-panel">
      <h2 class="section-title">Tu MisiÃ³n</h2>

      <div class="mission-item" id="m1">
        <div class="mission-num" data-n="1"></div>
        <p class="mission-text">Conecta el <strong>+ rojo</strong> de la baterÃ­a con la <strong>entrada del interruptor</strong></p>
      </div>
      <div class="mission-item" id="m2">
        <div class="mission-num" data-n="2"></div>
        <p class="mission-text">Conecta la <strong>salida del interruptor</strong> con un <strong>extremo de la resistencia</strong></p>
      </div>
      <div class="mission-item" id="m3">
        <div class="mission-num" data-n="3"></div>
        <p class="mission-text">Conecta el <strong>otro extremo</strong> de la resistencia con el <strong>+ del LED</strong> (pata larga)</p>
      </div>
      <div class="mission-item" id="m4">
        <div class="mission-num" data-n="4"></div>
        <p class="mission-text">Conecta el <strong>âˆ’ del LED</strong> (pata corta) con el <strong>âˆ’ negro</strong> de la baterÃ­a</p>
      </div>

      <div class="instr-box">
        ğŸ¯ <strong>Toca</strong> un punto dorado, luego <strong>toca otro</strong> para trazar el cable.<br><br>
        âš ï¸ Se necesitan <strong>exactamente 4 cables</strong>.<br><br>
        ğŸ’¡ Respeta la <strong>polaridad del LED</strong>: pata larga = (+).
      </div>

      <button class="btn btn-verify" onclick="verify()">âœ“ VERIFICAR CIRCUITO</button>
      <button class="btn btn-reset" onclick="resetAll()">â†º REINICIAR TODO</button>
    </aside>

    <!-- Board Panel -->
    <div class="board-panel">
      <h2 class="section-title">Tablero de Circuitos</h2>
      <div class="touch-hint">ğŸ“± Toca un punto dorado â†’ luego toca otro para conectar</div>

      <div class="pcb-wrapper">
        <div id="board">
          <!-- HUD -->
          <div class="board-hud">
            <div class="hud-dot"></div>
            <span class="hud-text">CIRCUITO ACTIVO</span>
            <div class="hud-dot"></div>
          </div>
          <!-- Corners -->
          <div class="corner tl"></div>
          <div class="corner tr"></div>
          <div class="corner bl"></div>
          <div class="corner br"></div>

          <!-- Wire SVG -->
          <svg id="wire-svg"></svg>

          <!-- BATTERY -->
          <div class="comp" id="comp-battery">
            <div class="cp" data-comp="battery" data-term="positive" data-tip="+ Positivo BaterÃ­a"
                 style="top:-20px;left:50%;transform:translateX(-50%)"></div>
            <div class="comp-shell">
              <div class="battery-body">
                <div class="battery-pole pole-pos"></div>
                <div class="battery-volt">9V</div>
                <div class="battery-sign sign-pos">+</div>
                <div class="battery-sign sign-neg">âˆ’</div>
                <div class="battery-pole pole-neg"></div>
              </div>
            </div>
            <div class="cp" data-comp="battery" data-term="negative" data-tip="âˆ’ Negativo BaterÃ­a"
                 style="bottom:-20px;left:50%;transform:translateX(-50%)"></div>
          </div>

          <!-- SWITCH -->
          <div class="comp" id="comp-switch">
            <div class="cp" data-comp="switch" data-term="in" data-tip="Entrada Interruptor"
                 style="top:50%;left:-20px;transform:translateY(-50%)"></div>
            <div class="comp-shell">
              <div class="switch-body">
                <div class="switch-btn" id="sw-btn" onclick="toggleSwitch(event)">OFF</div>
                <div class="switch-led-strip">
                  <div class="s-led"></div>
                  <div class="s-led"></div>
                  <div class="s-led"></div>
                </div>
              </div>
              <div class="switch-state-label" id="sw-label">APAGADO</div>
            </div>
            <div class="cp" data-comp="switch" data-term="out" data-tip="Salida Interruptor"
                 style="top:50%;right:-20px;transform:translateY(-50%)"></div>
          </div>

          <!-- RESISTOR -->
          <div class="comp" id="comp-resistor">
            <div class="cp" data-comp="resistor" data-term="left" data-tip="Extremo Izquierdo â€” 330Î©"
                 style="top:50%;left:-22px;transform:translateY(-50%)"></div>
            <div class="comp-shell" style="padding:6px 4px">
              <div style="position:relative">
                <div class="res-lead res-lead-l"></div>
                <div class="resistor-body">
                  <div class="res-label">330Î©</div>
                </div>
                <div class="res-lead res-lead-r"></div>
              </div>
            </div>
            <div class="cp" data-comp="resistor" data-term="right" data-tip="Extremo Derecho â€” 330Î©"
                 style="top:50%;right:-22px;transform:translateY(-50%)"></div>
          </div>

          <!-- LED -->
          <div class="comp" id="comp-led">
            <div class="led-pin pin-long"></div>
            <div class="led-sign lsign-pos">+</div>
            <div class="cp" data-comp="led" data-term="positive" data-tip="+ Ãnodo (pata larga)"
                 style="top:-22px;left:12px"></div>
            <div class="comp-shell" style="border-radius:50% 50% 12px 12px;padding:7px">
              <div class="led-dome"></div>
            </div>
            <div class="cp" data-comp="led" data-term="negative" data-tip="âˆ’ CÃ¡todo (pata corta)"
                 style="bottom:-18px;right:12px"></div>
            <div class="led-sign lsign-neg">âˆ’</div>
            <div class="led-pin pin-short"></div>
          </div>

        </div><!-- /board -->
      </div><!-- /pcb-wrapper -->
    </div><!-- /board-panel -->

  </div><!-- /main-grid -->

  <!-- â•â•â• INFO SECTION â•â•â• -->
  <section class="info-section">
    <div class="info-block">
      <div class="info-block-title">Â¿CÃ³mo funciona?</div>
      <p>El <strong>interruptor</strong> actÃºa como puerta para la electricidad. En <strong>ON</strong>, la corriente fluye: baterÃ­a â†’ interruptor â†’ resistencia â†’ LED â†’ baterÃ­a.</p>
      <p>En <strong>OFF</strong>, el circuito queda abierto y el LED se apaga instantÃ¡neamente.</p>
    </div>
    <div class="info-block">
      <div class="info-block-title">Â¿Por quÃ© la resistencia?</div>
      <p>La <strong>resistencia de 330Î©</strong> limita la corriente para que el LED no reciba mÃ¡s de la que puede soportar.</p>
      <p>Sin ella, el LED se quemarÃ­a en fracciones de segundo por sobrecorriente.</p>
    </div>
  </section>

</div><!-- /container -->

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- CELEBRATION -->
<div class="overlay" id="overlay-celeb">
  <div class="modal-card">
    <button class="modal-close" onclick="closeOverlay('overlay-celeb')">âœ•</button>
    <span class="modal-emoji">ğŸ‰</span>
    <div class="modal-title">Â¡MISIÃ“N CUMPLIDA!</div>
    <p class="modal-text">
      Â¡Excelente trabajo, futuro ingeniero! ğŸŒŸ<br><br>
      Has conectado el circuito correctamente.<br>
      Ahora presiona el <strong>interruptor</strong> para encender el LED. ğŸ’¡
    </p>
    <button class="btn btn-verify" onclick="closeOverlay('overlay-celeb')">ğŸš€ CONTINUAR</button>
  </div>
</div>

<!-- INFO MODAL -->
<div class="info-modal" id="info-modal">
  <div class="info-modal-card">
    <button class="modal-close" onclick="closeModal()" style="position:absolute;top:14px;right:14px">âœ•</button>
    <div id="modal-body"></div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const INFO = {
  battery: {
    title: 'ğŸ”‹ BaterÃ­a â€” Fuente de EnergÃ­a',
    sections: [
      { h: 'Â¿QuÃ© es?', p: 'Convierte <strong>energÃ­a quÃ­mica</strong> en <strong>elÃ©ctrica</strong>. Sin ella el circuito no tiene energÃ­a.' },
      { h: 'Terminales', p: 'Dos polos:', ul: [
        '<strong>Positivo (+):</strong> Marcado en rojo. La corriente sale de aquÃ­.',
        '<strong>Negativo (âˆ’):</strong> Marcado en negro. La corriente regresa aquÃ­.',
        '<strong>9V:</strong> La diferencia de potencial que "empuja" los electrones.'
      ]},
      { h: 'SÃ­mbolo elÃ©ctrico', p: 'LÃ­neas largas (+) y cortas (âˆ’) alternadas:', svg: `
        <svg class="circuit-svg" viewBox="0 0 120 60">
          <line x1="10" y1="30" x2="35" y2="30" stroke="#00e5ff" stroke-width="3"/>
          <line x1="35" y1="12" x2="35" y2="48" stroke="#ef4444" stroke-width="5"/>
          <line x1="47" y1="18" x2="47" y2="42" stroke="#00e5ff" stroke-width="3"/>
          <line x1="60" y1="12" x2="60" y2="48" stroke="#ef4444" stroke-width="5"/>
          <line x1="72" y1="18" x2="72" y2="42" stroke="#00e5ff" stroke-width="3"/>
          <line x1="72" y1="30" x2="110" y2="30" stroke="#00e5ff" stroke-width="3"/>
          <text x="35" y="8" font-size="13" fill="#ef4444" text-anchor="middle" font-weight="bold">+</text>
          <text x="72" y="58" font-size="13" fill="#94a3b8" text-anchor="middle" font-weight="bold">âˆ’</text>
        </svg>` },
      { h: 'âš ï¸ Seguridad', p: '<strong>Nunca conectes + y âˆ’ directamente</strong> sin componentes. CausarÃ­as un cortocircuito peligroso.' }
    ]
  },
  switch: {
    title: 'âš¡ Interruptor â€” La Puerta ElÃ©ctrica',
    sections: [
      { h: 'Â¿QuÃ© es?', p: 'Una <strong>puerta controlada</strong> para la corriente. Abierta (OFF) = no pasa corriente. Cerrada (ON) = pasa libremente.' },
      { h: 'Estados', p: 'Funciona con dos posiciones:', ul: [
        '<strong>OFF (Abierto):</strong> Corta el circuito. Como cerrar una llave de agua.',
        '<strong>ON (Cerrado):</strong> Completa el circuito. La corriente fluye.',
        'Es exactamente como el interruptor de luz de tu casa.'
      ]},
      { h: 'Tipos comunes', ul: [
        '<strong>Pulsador:</strong> Solo activo mientras se presiona.',
        '<strong>De palanca:</strong> Queda fijo en la posiciÃ³n elegida.',
        '<strong>Deslizante:</strong> Se mueve de lado a lado.',
        '<strong>TÃ¡ctil:</strong> Basta con rozarlo.'
      ]},
      { h: 'SÃ­mbolo elÃ©ctrico', svg: `
        <svg class="circuit-svg" viewBox="0 0 140 80">
          <line x1="10" y1="48" x2="40" y2="48" stroke="#00e5ff" stroke-width="4"/>
          <circle cx="40" cy="48" r="5" fill="#f59e0b"/>
          <line x1="40" y1="48" x2="80" y2="26" stroke="#ef4444" stroke-width="4"/>
          <circle cx="96" cy="48" r="5" fill="#f59e0b"/>
          <line x1="96" y1="48" x2="130" y2="48" stroke="#00e5ff" stroke-width="4"/>
          <text x="70" y="72" font-size="10" fill="rgba(226,232,240,0.5)" text-anchor="middle">Interruptor Abierto (OFF)</text>
        </svg>` }
    ]
  },
  resistor: {
    title: 'â”â”â”¯â”â” Resistencia â€” El Protector',
    sections: [
      { h: 'Â¿QuÃ© es?', p: 'Opone resistencia al paso de corriente. Como estrechar un tubo para reducir el flujo de agua.' },
      { h: 'FunciÃ³n en el circuito', ul: [
        'Protege al LED de recibir demasiada corriente.',
        'Sin ella, el LED se quema en segundos.',
        'Convierte el exceso de energÃ­a en calor.'
      ]},
      { h: 'ğŸ¨ CÃ³digo de Colores', p: 'Las bandas de colores indican el valor:', table: `
        <table class="color-table">
          <thead><tr><th>Color</th><th>DÃ­gito</th><th>Multiplicador</th></tr></thead>
          <tbody>
            <tr><td><span class="color-swatch" style="background:#000"></span>Negro</td><td>0</td><td>Ã—1</td></tr>
            <tr><td><span class="color-swatch" style="background:#795548"></span>CafÃ©</td><td>1</td><td>Ã—10</td></tr>
            <tr><td><span class="color-swatch" style="background:#f44336"></span>Rojo</td><td>2</td><td>Ã—100</td></tr>
            <tr><td><span class="color-swatch" style="background:#ff9800"></span>Naranja</td><td>3</td><td>Ã—1K</td></tr>
            <tr><td><span class="color-swatch" style="background:#ffeb3b;border-color:#888"></span>Amarillo</td><td>4</td><td>Ã—10K</td></tr>
            <tr><td><span class="color-swatch" style="background:#4caf50"></span>Verde</td><td>5</td><td>Ã—100K</td></tr>
          </tbody>
        </table>
        <div style="background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:10px;padding:12px;margin-top:10px;font-size:0.88rem;color:#f59e0b;font-weight:700">
          ğŸ“Œ Nuestra 330Î©: Naranja(3) + Naranja(3) + CafÃ©(Ã—10) = 33 Ã— 10 = <strong style="color:#fff">330Î©</strong>
        </div>` },
      { h: 'ğŸ“ Dato curioso', p: 'Tu telÃ©fono tiene cientos de resistencias. Son el componente mÃ¡s usado en electrÃ³nica.' }
    ]
  },
  led: {
    title: 'ğŸ’¡ LED â€” Diodo Emisor de Luz',
    sections: [
      { h: 'Â¿QuÃ© significa LED?', p: '<strong>L</strong>ight <strong>E</strong>mitting <strong>D</strong>iode. Convierte electricidad en luz con muy alta eficiencia.' },
      { h: 'Polaridad â€” Â¡CrÃ­tico!', ul: [
        '<strong>Pata Larga (+) ÃNODO:</strong> Conectar al lado positivo del circuito.',
        '<strong>Pata Corta (âˆ’) CÃTODO:</strong> Conectar al lado negativo.',
        'Si lo conectas al revÃ©s no enciende, pero no se daÃ±a.',
        'Siempre necesita una resistencia en serie.'
      ]},
      { h: 'SÃ­mbolo elÃ©ctrico', svg: `
        <svg class="circuit-svg" viewBox="0 0 160 110">
          <line x1="10" y1="55" x2="42" y2="55" stroke="#00e5ff" stroke-width="4"/>
          <polygon points="42,33 42,77 82,55" fill="none" stroke="#ef4444" stroke-width="4"/>
          <line x1="82" y1="33" x2="82" y2="77" stroke="#ef4444" stroke-width="4"/>
          <line x1="82" y1="55" x2="120" y2="55" stroke="#00e5ff" stroke-width="4"/>
          <line x1="68" y1="22" x2="76" y2="8" stroke="#fbbf24" stroke-width="3" stroke-linecap="round"/>
          <line x1="78" y1="22" x2="86" y2="8" stroke="#fbbf24" stroke-width="3" stroke-linecap="round"/>
          <text x="30" y="100" font-size="11" fill="#ef4444" text-anchor="middle">+ ÃNODO</text>
          <text x="100" y="100" font-size="11" fill="#94a3b8" text-anchor="middle">âˆ’ CÃTODO</text>
        </svg>` },
      { h: 'ğŸŒˆ Colores de LEDs', ul: [
        '<strong>Rojo:</strong> 1.8â€“2.2V â€” el mÃ¡s comÃºn.',
        '<strong>Verde / Amarillo:</strong> 2.0â€“2.5V',
        '<strong>Azul / Blanco:</strong> 3.0â€“3.5V â€” mÃ¡s modernos.',
        '<strong>Infrarrojo:</strong> Invisible â€” usado en controles remotos.'
      ]},
      { h: 'ğŸ“ Historia', p: 'El primer LED fue creado en 1962. Los LEDs azules (1990) fueron tan revolucionarios que sus inventores ganaron el <strong>Nobel de FÃ­sica en 2014</strong>.' }
    ]
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let wires = [];
let selected = null;
let circuitDone = false;
let swOn = false;
let isDragging = false;
let dragEl = null, dragOffX = 0, dragOffY = 0, touchID = null;
const MAX_W = 4;
const WIRE_COLORS = ['#ef4444','#06b6d4','#3b82f6','#f59e0b'];
let colorIdx = 0;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
  positionComponents();
  initPoints();
  initDrag();
  resizeWireSVG();
  window.addEventListener('resize', () => { positionComponents(); resizeWireSVG(); redrawWires(); });
  updateUI();
});

/* Position components based on board size */
function positionComponents() {
  const board = document.getElementById('board');
  const W = board.offsetWidth || 700;
  const H = board.offsetHeight || 480;
  const midY = H / 2;

  const positions = {
    'comp-battery':  { left: Math.max(55, W * 0.08),  top: midY },
    'comp-switch':   { left: Math.max(180, W * 0.28), top: midY },
    'comp-resistor': { left: Math.max(330, W * 0.52), top: midY },
    'comp-led':      { left: Math.max(510, W * 0.74), top: midY },
  };

  for (const [id, pos] of Object.entries(positions)) {
    const el = document.getElementById(id);
    if (!el) continue;
    el.style.left = pos.left + 'px';
    el.style.top  = pos.top  + 'px';
    el.style.transform = 'translateY(-50%)';
  }

  // Mobile: stack vertically
  if (W < 600) {
    const cols = [W * 0.12, W * 0.55];
    const rows = [H * 0.15, H * 0.45, H * 0.25, H * 0.65];
    const els = ['comp-battery','comp-switch','comp-resistor','comp-led'];
    els.forEach((id, i) => {
      const el = document.getElementById(id);
      if (!el) return;
      const col = i < 2 ? cols[0] : cols[1];
      const row = i % 2 === 0 ? rows[0] : rows[1];
      if (i === 0) { el.style.left = cols[0]+'px'; el.style.top = rows[0]+'px'; }
      if (i === 1) { el.style.left = cols[0]+'px'; el.style.top = rows[1]+'px'; }
      if (i === 2) { el.style.left = cols[1]+'px'; el.style.top = rows[2]+'px'; }
      if (i === 3) { el.style.left = cols[1]+'px'; el.style.top = rows[3]+'px'; }
      el.style.transform = '';
    });
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONNECTION POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initPoints() {
  document.querySelectorAll('.cp').forEach(p => {
    p.addEventListener('click', handlePoint);
    p.addEventListener('touchstart', e => { e.preventDefault(); e.stopPropagation(); handlePoint(e); }, { passive: false });
  });
}

function handlePoint(e) {
  e.preventDefault(); e.stopPropagation();
  if (isDragging) return;
  const pt = e.currentTarget || e.target;

  if (!selected) {
    if (wires.length >= MAX_W) { toast('âš ï¸ Ya tienes los 4 cables conectados', 'warning'); return; }
    selected = pt;
    pt.classList.add('cp-selected');
    toast('Punto seleccionado â€” elige el destino', 'info');
  } else {
    if (selected === pt) {
      selected.classList.remove('cp-selected');
      selected = null;
      toast('SelecciÃ³n cancelada', 'info');
      return;
    }
    if (selected.dataset.comp === pt.dataset.comp) {
      selected.classList.remove('cp-selected');
      selected = null;
      toast('âŒ No puedes conectar el mismo componente', 'error');
      return;
    }
    addWire(selected, pt);
    selected.classList.remove('cp-selected');
    selected.classList.add('cp-connected');
    pt.classList.add('cp-connected');
    selected = null;
    updateUI();
    updateMissions();
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAG & DROP â€” FIXED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initDrag() {
  document.querySelectorAll('.comp').forEach(el => {
    el.addEventListener('mousedown', onDragStart);
    el.addEventListener('touchstart', onDragStart, { passive: false });
  });
  document.addEventListener('mousemove', onDragMove);
  document.addEventListener('touchmove', onDragMove, { passive: false });
  document.addEventListener('mouseup', onDragEnd);
  document.addEventListener('touchend', onDragEnd);
  document.addEventListener('touchcancel', onDragEnd);
}

function onDragStart(e) {
  const t = e.target;
  if (t.classList.contains('cp') || t.classList.contains('switch-btn')) return;
  e.preventDefault();

  dragEl = e.currentTarget;
  isDragging = false;

  // Remove transform so absolute positioning works cleanly
  const rect = dragEl.getBoundingClientRect();
  const board = document.getElementById('board');
  const bRect = board.getBoundingClientRect();

  // Convert current transform-based position to absolute
  const curLeft = dragEl.getBoundingClientRect().left - bRect.left;
  const curTop  = dragEl.getBoundingClientRect().top  - bRect.top;
  dragEl.style.transform = '';
  dragEl.style.left = curLeft + 'px';
  dragEl.style.top  = curTop  + 'px';

  if (e.type === 'touchstart') {
    const tc = e.touches[0];
    touchID = tc.identifier;
    dragOffX = tc.clientX - rect.left;
    dragOffY = tc.clientY - rect.top;
  } else {
    dragOffX = e.clientX - rect.left;
    dragOffY = e.clientY - rect.top;
  }
}

function onDragMove(e) {
  if (!dragEl) return;
  e.preventDefault();

  let cx, cy;
  if (e.type === 'touchmove') {
    const tc = Array.from(e.touches).find(t => t.identifier === touchID);
    if (!tc) return;
    cx = tc.clientX; cy = tc.clientY;
  } else {
    cx = e.clientX; cy = e.clientY;
  }

  isDragging = true;
  dragEl.classList.add('dragging');

  const board = document.getElementById('board');
  const br = board.getBoundingClientRect();
  const x = Math.max(0, Math.min(cx - br.left - dragOffX, br.width  - dragEl.offsetWidth));
  const y = Math.max(0, Math.min(cy - br.top  - dragOffY, br.height - dragEl.offsetHeight));

  dragEl.style.left = x + 'px';
  dragEl.style.top  = y + 'px';

  redrawWires();
}

function onDragEnd() {
  if (dragEl) {
    dragEl.classList.remove('dragging');
    redrawWires();
  }
  setTimeout(() => { isDragging = false; }, 80);
  dragEl = null; touchID = null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WIRES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addWire(p1, p2) {
  const t1 = p1.dataset.term, t2 = p2.dataset.term;
  let color;
  const pos = ['positive','in'];
  const neg = ['negative','out'];
  if (pos.includes(t1) && pos.includes(t2))      color = '#ef4444';
  else if (neg.includes(t1) && neg.includes(t2)) color = '#94a3b8';
  else                                             color = WIRE_COLORS[colorIdx++ % WIRE_COLORS.length];
  wires.push({ p1, p2, color });
  redrawWires();
  toast(`ğŸ”Œ Cable ${wires.length} conectado`, 'success');
}

function getCenter(el) {
  const board = document.getElementById('board');
  const br = board.getBoundingClientRect();
  const er = el.getBoundingClientRect();
  return {
    x: er.left - br.left + er.width  / 2,
    y: er.top  - br.top  + er.height / 2
  };
}

function resizeWireSVG() {
  const board = document.getElementById('board');
  const svg = document.getElementById('wire-svg');
  svg.setAttribute('width',  board.scrollWidth  || board.offsetWidth);
  svg.setAttribute('height', board.scrollHeight || board.offsetHeight);
}

function redrawWires() {
  const svg = document.getElementById('wire-svg');
  svg.innerHTML = '';
  const active = circuitDone && swOn;

  wires.forEach(w => {
    const a = getCenter(w.p1), b = getCenter(w.p2);
    const curl = Math.abs(b.x - a.x) * 0.35 + 30;

    // Shadow
    const shadow = makePath(a, b, curl);
    shadow.setAttribute('stroke', 'rgba(0,0,0,0.55)');
    shadow.setAttribute('stroke-width', '12');
    shadow.setAttribute('transform', 'translate(3,4)');
    svg.appendChild(shadow);

    // Main wire
    const path = makePath(a, b, curl);
    path.setAttribute('stroke', w.color);
    path.setAttribute('stroke-width', '7');
    path.style.filter = `drop-shadow(0 0 6px ${w.color})`;
    if (active) path.classList.add('wire-active');
    svg.appendChild(path);

    // Highlight
    const hi = makePath(a, b, curl);
    hi.setAttribute('stroke', 'rgba(255,255,255,0.35)');
    hi.setAttribute('stroke-width', '2.5');
    svg.appendChild(hi);
  });
}

function makePath(a, b, curl) {
  const p = document.createElementNS('http://www.w3.org/2000/svg', 'path');
  p.setAttribute('d', `M ${a.x} ${a.y} C ${a.x+curl} ${a.y}, ${b.x-curl} ${b.y}, ${b.x} ${b.y}`);
  p.setAttribute('fill', 'none');
  p.setAttribute('stroke-linecap', 'round');
  p.setAttribute('opacity', '0.95');
  return p;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SWITCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleSwitch(e) {
  if (e) { e.preventDefault(); e.stopPropagation(); }
  if (!circuitDone) { toast('âš ï¸ Primero completa y verifica el circuito', 'warning'); return; }

  swOn = !swOn;
  const comp = document.getElementById('comp-switch');
  const btn  = document.getElementById('sw-btn');
  const lbl  = document.getElementById('sw-label');

  if (swOn) {
    comp.classList.add('sw-on');
    btn.textContent = 'ON';
    lbl.textContent = 'ENCENDIDO';
    toast('âš¡ ENCENDIDO â€” Â¡El LED brilla!', 'success');
  } else {
    comp.classList.remove('sw-on');
    btn.textContent = 'OFF';
    lbl.textContent = 'APAGADO';
    toast('Interruptor apagado', 'info');
  }

  updateLED();
  updateUI();
  redrawWires();
}

function updateLED() {
  const led = document.getElementById('comp-led');
  if (circuitDone && swOn) led.classList.add('led-on');
  else led.classList.remove('led-on');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISSIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildMap() {
  const map = {};
  wires.forEach(w => {
    const k1 = `${w.p1.dataset.comp}-${w.p1.dataset.term}`;
    const k2 = `${w.p2.dataset.comp}-${w.p2.dataset.term}`;
    if (!map[k1]) map[k1] = [];
    if (!map[k2]) map[k2] = [];
    map[k1].push(k2);
    map[k2].push(k1);
  });
  return map;
}

function linked(map, a, b) {
  return map[a] ? map[a].includes(b) : false;
}

function updateMissions() {
  const map = buildMap();
  const m1 = linked(map, 'battery-positive', 'switch-in');
  const m2 = linked(map, 'switch-out', 'resistor-left') || linked(map, 'switch-out', 'resistor-right');
  const m3 = (linked(map, 'resistor-left', 'led-positive') || linked(map, 'resistor-right', 'led-positive'))
             && !linked(map, 'resistor-left', 'led-negative') && !linked(map, 'resistor-right', 'led-negative');
  const m4 = linked(map, 'led-negative', 'battery-negative');

  [['m1',m1],['m2',m2],['m3',m3],['m4',m4]].forEach(([id,done]) => {
    document.getElementById(id).classList.toggle('done', done);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VERIFY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function verify() {
  if (wires.length < MAX_W) {
    toast(`âŒ Faltan ${MAX_W - wires.length} cable(s)`, 'error');
    return;
  }
  const map = buildMap();
  const m1 = linked(map, 'battery-positive', 'switch-in');
  const m2 = linked(map, 'switch-out', 'resistor-left') || linked(map, 'switch-out', 'resistor-right');
  const m3 = (linked(map, 'resistor-left', 'led-positive') || linked(map, 'resistor-right', 'led-positive'))
             && !linked(map, 'resistor-left', 'led-negative') && !linked(map, 'resistor-right', 'led-negative');
  const m4 = linked(map, 'led-negative', 'battery-negative');

  if (m1 && m2 && m3 && m4) {
    circuitDone = true;
    document.getElementById('overlay-celeb').classList.add('active');
    spawnConfetti();
    toast('âœ… Â¡CORRECTO! Ahora usa el interruptor', 'success');
  } else {
    circuitDone = false;
    updateLED();
    let msg = 'âŒ Conexiones incorrectas: ';
    if (!m1) msg += 'BaterÃ­a(+)â†’Interruptor. ';
    if (!m2) msg += 'Interruptorâ†’Resistencia. ';
    if (!m3) msg += 'Resistenciaâ†’LED(+). ';
    if (!m4) msg += 'LED(âˆ’)â†’BaterÃ­a(âˆ’).';
    toast(msg, 'error');
  }
  updateUI();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function resetAll() {
  wires = [];
  colorIdx = 0;
  document.getElementById('wire-svg').innerHTML = '';
  document.querySelectorAll('.cp').forEach(p => p.classList.remove('cp-connected','cp-selected'));
  selected = null;
  circuitDone = false;
  swOn = false;

  document.getElementById('comp-switch').classList.remove('sw-on');
  document.getElementById('sw-btn').textContent = 'OFF';
  document.getElementById('sw-label').textContent = 'APAGADO';
  document.getElementById('comp-led').classList.remove('led-on');

  ['m1','m2','m3','m4'].forEach(id => document.getElementById(id).classList.remove('done'));
  updateUI();
  toast('â†º Reiniciado â€” Â¡intÃ©ntalo de nuevo!', 'info');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateUI() {
  // Wires badge
  document.getElementById('badge-wires-txt').textContent = `${wires.length} / ${MAX_W} cables`;

  // Switch badge
  const swBadge = document.getElementById('badge-switch');
  swBadge.querySelector('span:last-child').textContent = swOn ? 'Interruptor ON' : 'Interruptor OFF';
  swBadge.classList.toggle('on', swOn);

  // LED badge
  const ledOn = document.getElementById('comp-led').classList.contains('led-on');
  const ledBadge = document.getElementById('badge-led');
  ledBadge.querySelector('span:last-child').textContent = ledOn ? 'LED ON' : 'LED OFF';
  ledBadge.classList.toggle('on', ledOn);

  // Progress
  const pct = Math.round(wires.length / MAX_W * 100);
  document.getElementById('prog-fill').style.width = pct + '%';
  document.getElementById('prog-pct').textContent = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(key) {
  const d = INFO[key];
  let html = `<div class="info-modal-title">${d.title}</div>`;
  d.sections.forEach(s => {
    html += `<div class="info-section-block"><h3>${s.h}</h3>`;
    if (s.p)     html += `<p>${s.p}</p>`;
    if (s.ul)    html += '<ul>' + s.ul.map(i=>`<li>${i}</li>`).join('') + '</ul>';
    if (s.svg)   html += s.svg;
    if (s.table) html += s.table;
    html += '</div>';
  });
  document.getElementById('modal-body').innerHTML = html;
  document.getElementById('info-modal').classList.add('active');
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('info-modal').classList.remove('active');
  document.body.style.overflow = '';
}

function closeOverlay(id) {
  document.getElementById(id).classList.remove('active');
}

document.addEventListener('click', e => {
  if (e.target === document.getElementById('info-modal'))    closeModal();
  if (e.target === document.getElementById('overlay-celeb')) closeOverlay('overlay-celeb');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function toast(msg, type='info') {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.className = `toast toast-${type} show`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => el.classList.remove('show'), 4000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function spawnConfetti() {
  const cols = ['#ef4444','#f59e0b','#22c55e','#3b82f6','#a855f7','#ec4899','#06b6d4'];
  for (let i = 0; i < 70; i++) {
    const c = document.createElement('div');
    c.className = 'confetti-p';
    c.style.cssText = `
      left:${Math.random()*100}%;top:-20px;
      background:${cols[i % cols.length]};
      animation-delay:${Math.random()*2.5}s;
      animation-duration:${Math.random()*2+3}s;
      transform:rotate(${Math.random()*360}deg);
      width:${Math.random()*10+6}px;height:${Math.random()*10+6}px;
    `;
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 7000);
  }
}
</script>
</body>
</html>
